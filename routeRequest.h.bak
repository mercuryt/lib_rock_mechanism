/*
 * This class provides a thread task object, with read and write steps.
 * Read step finds a path in the route cache or generates one and stores it with any newly generated adjacentMoveCosts.
 * Write step assigns the path to the actor and to the actor.m_location->m_routeCache, stores newly generated adjacentMoveCosts in location, and schedules the first step on the new path.
 */
#pragma once
#include "shape.h"

class RouteRequest
{
public:
	ACTOR& m_actor;
	bool m_detour;
	std::vector<DerivedBlock*> m_result;
	std::unordered_map<DerivedBlock*, std::vector<std::pair<DerivedBlock*, uint32_t>>> m_moveCostsToCache;
	bool m_cacheHit;

	static void readSteps(std::vector<RouteRequest>::iterator begin, std::vector<RouteRequest>::iterator end);

	RouteRequest(ACTOR& a, bool detour = false);
	
	// Find the route.
	void readStep();
	// Cache found route and move costs. Apply to actor and schedule first move step.
	void writeStep();
};
